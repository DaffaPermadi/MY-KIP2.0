<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My KIP</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <!-- partial:index.partial.html -->
    <div class="demo-page">
      <main class="demo-page-content">
        <section>
          <div class="href-target" id="intro"></div>
          <h1 class="package-name">MY KIP V2</h1>
          <p>
            MY KIP adalah platform pendaftaran online yang memanfaatkan
            teknologi machine learning untuk mempermudah dan mempercepat proses
            pendaftaran Kartu Indonesia Pintar (KIP) untuk beasiswa kuliah.
            Dengan menggunakan algoritme cerdas, MY KIP mampu melakukan
            penyeleksian secara otomatis, mengurangi risiko kesalahan manusia
            dalam proses evaluasi dan pengelolaan aplikasi.
          </p>
          <!-- <strong>In a nutshell:</strong>
          <ul>
            <li>It provides a sensible input styling 'reset'</li>
            <li>Get nice looking forms with zero effort</li>
            <li>Easily customizable with css-variables</li>
            <li>
              Perfect for rapid prototyping or tweak it and make it your own.
            </li>
            <li>No hacks or unnecessary elements, pure semantics</li>
          </ul> -->
        </section>

        <section>
          <div class="href-target" id="structure"></div>
          <h1>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="feather feather-layers"
            >
              <polygon points="12 2 2 7 12 12 22 7 12 2" />
              <polyline points="2 17 12 22 22 17" />
              <polyline points="2 12 12 17 22 12" />
            </svg>
            Form Pendaftaran MY KIP
          </h1>
          <form >
            
            <div class="nice-form-group">
              <label>NIK</label>
              <input type="text" placeholder="NIK" />
            </div>
            <div class="nice-form-group">
              <label>NISN</label>
              <input type="text" placeholder="NISN" />
            </div>
            <div class="nice-form-group">
              <label>NPSN</label>
              <input type="text" placeholder="NPSN" />
            </div>
            <div class="nice-form-group">
              <label>Nama Lengkap</label>
              <input type="text" placeholder="Nama Lengkap" />
            </div>
            <fieldset class="nice-form-group">
              <legend>Jenis Kelamin</legend>
              <div class="nice-form-group">
                <input type="radio" name="JK" id="laki" />
                <label for="laki">Laki - Laki</label>
              </div>
  
              <div class="nice-form-group">
                <input type="radio" name="JK" id="perempuan" />
                <label for="perempuan">Perempuan</label>
              </div>
            </fieldset>
            <div class="nice-form-group">
              <label>Tempat Lahir</label>
              <input type="text" placeholder="Tempat Lahir" />
            </div>
  
            <div class="nice-form-group">
              <label>Tanggal Lahir</label>
              <input type="date" value="2018-07-22" />
            </div>
  
            <div class="nice-form-group">
              <label>Nama Ibu Kandung</label>
              <input type="text" placeholder="Nama Ibu Kandung" />
            </div>
            <div class="nice-form-group">
              <label>Alamat Lengkap</label>
              <textarea type="text" placeholder="Alamat"></textarea>
            </div>
            <div class="nice-form-group">
              <label>Kode Pos</label>
              <input type="text" placeholder="Kode Pos" />
            </div>
            <div class="nice-form-group">
              <label>Agama</label>
              <input type="text" placeholder="Agama" />
            </div>
            <div class="nice-form-group">
              <label>Agama</label>
              <select>
                <option disabled selected>Pilih Agama</option>
                <option>Islam</option>
                <option>Kristen</option>
                <option>Katolik</option>
                <option>Hindu</option>
                <option>Buddha</option>
                <option>Kong Hu Chu</option>
              </select>
            </div>
            <div class="nice-form-group">
              <label>Gaji Orang Tua</label>
              <input type="text" placeholder="Contoh : 5000000 (tanpa titik)" />
            </div>
  
            <fieldset class="nice-form-group">
              <legend>Perguruan Tinggi</legend>
              <div class="nice-form-group">
                <input type="radio" name="PT" id="PTN" />
                <label for="PTN">PTN</label>
              </div>
  
              <div class="nice-form-group">
                <input type="radio" name="PT" id="PTS" />
                <label for="PTS">PTS</label>
              </div>
            </fieldset>
  
            <fieldset class="nice-form-group">
              <legend>Memiliki Prestasi ?</legend>
              <div class="nice-form-group">
                <input type="radio" name="prestasi" id="Iya" />
                <label for="Iya">Iya</label>
              </div>
  
              <div class="nice-form-group">
                <input type="radio" name="prestasi" id="Tidak" />
                <label for="Tidak">Tidak</label>
              </div>
            </fieldset>
  
            <div class="nice-form-group">
              <label>Nama Universitas</label>
              <input type="text" placeholder="Nama Universitas" />
            </div>
            <div class="nice-form-group">
              <label>Jurusan</label>
              <input type="text" placeholder="Jurusan" />
            </div>
            <div class="nice-form-group">
              <label>Semester</label>
              <input type="text" placeholder="Jurusan" />
            </div>
            <div class="nice-form-group">
              <label>UKT per Semester</label>
              <input type="text" placeholder="UKT per Semester" />
            </div>
            <div class="nice-form-group">
              <label>IPK</label>
              <input type="text" placeholder="IPK" />
            </div>
            <div class="nice-form-group">
              <label>Foto Rumah</label>
              <input type="file" id="fileInput" />
            </div>
            <div class="nice-form-group">
              <button
                class="submit-button"
                id="processButton"
                onclick="startPrediction()"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  class="feather feather-external-link"
                >
                  <path
                    d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                  />
                  <polyline points="15 3 21 3 21 9" />
                  <line x1="10" y1="14" x2="21" y2="3" />
                </svg>
                Submit
              </button>
              <div id="predictionResult"></div>
            </div>
          </section>
          </form>


        <footer>Copyright MYKIP V2</footer>
      </main>
    </div>
    <!-- partial -->
    <script>
      // Fungsi untuk memulai prediksi
      async function startPrediction() {
          const inputElement = document.getElementById("fileInput");
          const splitSize = 0.8; // Sesuaikan dengan ukuran split yang diinginkan
          await processImage(inputElement, splitSize);
      }

      // Ambil data dari Google Drive
const url =
  "https://drive.google.com/uc?id=1g6EQGwMZvstP7Q5uioca4Yk30n6DlfgU&export=download&confirm=t";
const localZip = "house_image.zip";

// Fungsi untuk membuat direktori jika tidak ada
function createDirIfNotExists(dir) {
  if (!fs.existsSync(dir)) {
    fs.mkdirSync(dir);
    console.log(`Created directory: ${dir}`);
  }
}

// Fungsi untuk mengekstrak berkas ZIP
function extractZip(zipPath, targetDir) {
  const AdmZip = require("adm-zip");
  const zip = new AdmZip(zipPath);
  zip.extractAllTo(targetDir, true);
  console.log(`Extracted ZIP file: ${zipPath}`);
}

// Fungsi untuk membagi dataset menjadi pelatihan dan validasi
function splitDataset(sourceDir, trainDir, testDir, splitSize) {
  const fs = require("fs");
  const path = require("path");
  const files = fs.readdirSync(sourceDir);
  files.forEach((file) => {
    const sourcePath = path.join(sourceDir, file);
    const destDir = Math.random() < splitSize ? trainDir : testDir;
    const destPath = path.join(destDir, file);
    fs.copyFileSync(sourcePath, destPath);
  });
}

// Fungsi untuk memuat gambar dari input file
async function loadImage(inputElement) {
  const file = inputElement.files[0];
  const reader = new FileReader();

  return new Promise((resolve, reject) => {
    reader.onload = function (e) {
      const image = new Image();
      image.src = e.target.result;
      image.onload = () => resolve(tf.browser.fromPixels(image));
      image.onerror = (error) => reject(error);
    };

    reader.readAsDataURL(file);
  });
}

async function loadCustomBaseModel() {
  const imageShape = [224, 224, 3]; // Sesuaikan dengan bentuk gambar yang Anda gunakan

  const customBaseModel = await tf.loadLayersModel(
    "path/to/your/custom/model/model.json"
  );
  customBaseModel.trainable = true;

  const flattenLayer = tf.layers.flatten();
  const denseLayer1 = tf.layers.dense({ units: 256, activation: "relu" });
  const batchNorm1 = tf.layers.batchNormalization();
  const denseLayer2 = tf.layers.dense({ units: 128, activation: "relu" });
  const batchNorm2 = tf.layers.batchNormalization();
  const denseLayer3 = tf.layers.dense({
    units: 64,
    activation: "relu",
    kernelRegularizer: tf.regularizers.l2(),
    activityRegularizer: tf.regularizers.l1(),
    biasRegularizer: tf.regularizers.l1(),
  });
  const dropoutLayer = tf.layers.dropout({ rate: 0.5 });
  const outputLayer = tf.layers.dense({ units: 1, activation: "linear" });

  const input = tf.input({ shape: imageShape });
  let x = customBaseModel.apply(input);
  x = flattenLayer.apply(x);
  x = denseLayer1.apply(x);
  x = batchNorm1.apply(x);
  x = denseLayer2.apply(x);
  x = batchNorm2.apply(x);
  x = denseLayer3.apply(x);
  x = dropoutLayer.apply(x);
  const output = outputLayer.apply(x);

  const model = tf.model({ inputs: input, outputs: output });

    model.compile({
      optimizer: tf.train.adam(),
      loss: "binaryCrossentropy",
      metrics: ["accuracy"],
    });

    return model;
  }

  let model; // Simpan model di sini
  // Inisialisasi model saat dokumen dimuat
  document.addEventListener("DOMContentLoaded", async function () {
    model = await loadCustomBaseModel();
  });

  //ProcessImage
  async function processImage(inputElement, splitSize) {
    // Persiapkan direktori dan dataset
    createDirIfNotExists("/content");
    createDirIfNotExists("/content/Houses-Images");
    createDirIfNotExists("/content/Houses-Images/not_eligible");
    createDirIfNotExists("/content/Houses-Images/eligible");
    const trainDir = "/content/Houses-Images/train";
    const testDir = "/content/Houses-Images/test";
    createDirIfNotExists(trainDir);
    createDirIfNotExists(testDir);

    // Ekstrak berkas ZIP
    extractZip(localZip, "/content");

    // Bagi dataset
    splitDataset(
      "/content/Houses-Images/not_eligible",
      `${trainDir}/not_eligible`,
      `${testDir}/not_eligible`,
      splitSize
    );
    splitDataset(
      "/content/Houses-Images/eligible",
      `${trainDir}/eligible`,
      `${testDir}/eligible`,
      splitSize
    );

    // Mulai memuat gambar
    const imageTensor = await loadImage(inputElement);

    // Lakukan normalisasi
    const normalizedImage = tf
      .div(imageTensor, 255.0)
      .reshape([1, ...image_shape]);

    // Lakukan prediksi menggunakan model
    const prediction = model.predict(normalizedImage);

    // Proses hasil prediksi di sini
    const resultElement = document.getElementById("predictionResult");
    resultElement.innerText = `Hasil Prediksi: ${prediction.dataSync()}`;
  }
  </script>
    <script src="script.js"></script>
  </body>
</html>
